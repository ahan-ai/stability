\documentclass[12pt]{book}
\usepackage{xeCJK}
\usepackage{fontspec}
\usepackage{hyperref}

\usepackage{xurl}              % 支持更智能的 URL 换行
\setlength{\emergencystretch}{3em}  % 容许 LaTeX 自动拉伸行距，减少 Overfull
\usepackage{microtype}  % 更好的排版,微调间距，使超宽行不再报错

\usepackage{array}      % Pandoc 生成的 >{\raggedright\arraybackslash} 需要
\usepackage{longtable}  % Pandoc 默认表格环境
\usepackage{booktabs}   % Pandoc 默认用的横线命令
\usepackage{calc}       % 处理 p{(\linewidth - ...)} 的列宽计算
\usepackage{graphicx}

\usepackage{indentfirst} % 让章节首段缩进
\setlength{\parindent}{2em} % 设置缩进为 2 个汉字宽
% 如果只想简单处理，直接让 pandocbounded 等于原内容
\newcommand{\pandocbounded}[1]{#1}

\usepackage[strings]{underscore}  % 允许章节名里用下划线
% 设置中文字体
\setCJKmainfont[
  Path=./chapters/fonts/,
  BoldFont = NotoSansCJKsc-Bold,
  ItalicFont = NotoSansCJKsc-Regular,      % 斜体用伪斜体
  BoldItalicFont = NotoSansCJKsc-Bold,    % 粗斜体用粗体 + 伪斜体
  AutoFakeSlant = 0.2
]{NotoSansCJKsc-Regular}
\setCJKfamilyfont{hei}[Path=./chapters/fonts/]{NotoSansCJKsc-Bold}

% ✅ 新增：定义中文等宽字体，供 \texttt{}、verbatim 等使用
\setCJKmonofont[
  Path=./chapters/fonts/,
  AutoFakeSlant = 0.1
]{NotoSansCJKsc-Regular}

\setmainfont{Times New Roman}

% listings：自动换行、且断行标记用简单可靠的表达式
\usepackage{xcolor}
\usepackage{listings}

\lstset{
  basicstyle=\ttfamily\small,
  breaklines=true,            % 自动换行
  breakatwhitespace=false,    % 允许在任意位置断行（必要时）
  columns=fixed,              % 关键：使用 fixed 列模型，避免分割宏 token
  keepspaces=true,
  showstringspaces=false,
  postbreak=\raisebox{0pt}[0pt][0pt]{\ensuremath{\rightarrow}\,}, % 简洁箭头（不含 \textcolor）
  % 如果你还想要灰色箭头，可以用下面这行（但 prior 版本更稳健）
  % postbreak=\raisebox{0pt}[0pt][0pt]{\color{gray}\ensuremath{\rightarrow}\,},
  frame=none
}

% --- fix Pandoc passthrough ---
\newcommand{\passthrough}[1]{#1}


% 使用 \textbf{} 时，Bold 字体会生效
\renewcommand{\bfdefault}{b}
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% 移除空白页
\makeatletter
\let\cleardoublepage\clearpage
\makeatother


\begin{document}
<% for part in parts %>
\part{ << part.title >> }
<< part.readme_tex >>

<% for chapter in part.chapters_data %>
\chapter{ << chapter.title >> }
<< chapter.tex >>
<% endfor %>

<% endfor %>

\end{document}
