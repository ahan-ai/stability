# 告警机制

告警的机制可以分为基于阈值的告警、基于事件的告警和基于日志的告警。

**基于指标的告警**

基于指标的告警是告警方案里最基本，也最简单的告警方式。其告警公式如下：

某个统计值（平均值、最大值、99分位值等）   大于（或小于、） 某个阈值，达到一定时间，产生告警。根据统计值的不同，阈值的不同，比较方式的不同，可以构造出各种告警规则。

**基于事件的告警**

某一事件的发生，也可以成为告警的来源。例如，ECS 实例被删除。

**基于日志的告警**

分析日志中的关键字、错误码或异常模式，触发告警。

- 示例：
    - 日志中出现 “ERROR”“Exception”“500 Internal Server Error”。
    - 特定业务日志异常（如支付系统出现 “支付失败且未回滚”）。

# 告警配置的原则

每当告警发生时，值班同学需要暂停手头工作查看告警。这种中断严重影响工作效率，增加研发成本，尤其对正在开发调试的同学影响更大。因此，我们希望收到的每个告警都能真实反映异常情况：既不能误报（对正常状态报警），也不能错报（错过该报的警报）。然而，误报和错报往往是一对相互矛盾的指标。

- 从监控范围出发：为了避免误报，需要增加更多监控指标，但增加指标反而可能带来更多误报。
- 从阈值角度出发：对于阈值类监控，阈值设置过高会降低误报概率但提高错报概率；反之，阈值过低则会提高误报概率但降低错报概率。

在初始配置告警时，我们应尽可能扩大监控告警覆盖面，选择保守的阈值以避免错报。随后需要定期对告警进行统计分析，合理屏蔽或简化误报警报，这是一个持续优化的过程。结合项目经验和《Google SRE》的观点，推荐以下告警设置原则：

- 真实性：告警必须反映真实存在的现象，展示服务当前或即将出现的问题。
- 表述详细：告警内容要尽可能详细地描述现象，例如服务器在具体时间点发生的具体异常。
- 可操作性：收到告警后通常需要采取相应操作，对于不需要操作的告警最好取消。例如，磁盘IO量或CPU使用率的瞬时飙高，对某些业务而言可能不需要立即处理，这类告警的意义就不大。可操作性原则尤为重要，遵循这一原则能有效减少误报。