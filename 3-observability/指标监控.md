监控指标（Monitoring Metrics）是对系统状态和性能进行量化描述的数值化数据，通常以时间序列的形式记录关键指标，如CPU使用率、内存占用、磁盘I/O、网络流量、请求延迟、错误率等。这些指标能够直观反映系统在运行过程中的健康状况和性能趋势。

# 监控指标是可观测性的基础

- **即时反馈系统状态**
    
    监控指标提供了系统运行的实时数据，让运维人员能迅速了解系统是否处于正常状态。当某个关键指标出现异常时，可以及时发出预警，帮助迅速定位问题。
    
- **数据驱动决策**
    
    有了明确的数值指标，团队可以基于数据分析系统的性能瓶颈、资源利用情况以及潜在故障点，为系统优化和扩展提供有力依据。
    
- **跨层级分析问题**
    
    通过指标的聚合和分析，可以从整体到局部追踪系统性能问题，为故障排查提供方向和依据。监控指标是实现日志、追踪等其他数据互补的基础。
    
- **自动化与报警**
    
    利用预设的指标阈值，可以自动触发报警机制，确保在问题初现时便能得到关注并迅速响应，从而保障系统稳定性和安全性。
    

# 监控指标设计原则

在监控指标设计中，**VALET 原则**是一种用于筛选和定义关键指标的框架，尤其在 SLO（服务等级目标）和 SRE（站点可靠性工程）领域广泛应用。它通过五个核心维度帮助团队聚焦用户体验和系统稳定性，确保监控指标能够准确反映服务质量并指导决策。以下是 VALET 原则的详细解析：

## **VALET 原则的核心维度**

### **1. Volume（容量）**

指服务承诺的最大处理能力，例如 QPS（每秒请求数）、TPS（每秒事务数）、并发连接数等。通过监控容量指标，团队可以评估系统是否在设计负载范围内运行，并为流量峰值（如电商大促）制定预案。

- **示例**：数据库连接数、容器集群可用节点数、API 接口调用量。
- **应用场景**：容量规划、资源弹性扩展、故障隔离策略制定。

### **2. Availability（可用性）**

衡量服务正常运行的时间比例，通常以请求成功率（如非 5xx 状态码比例）或服务实例存活状态为指标。可用性是用户体验的直接体现，也是 SLO 中最常见的指标之一。

- **示例**：服务主备状态、任务执行成功率、HTTP 请求成功率。
- **应用场景**：故障恢复效率评估、错误预算分配、SLO 目标设定。

### **3. Latency（时延）**

指请求从发起至完成的时间，包括响应时间、处理耗时等。时延直接影响用户体验，需通过分位数（如 90% 请求时延≤80ms）而非平均值来精确评估58。

- **示例**：API 接口响应时间、数据库慢查询、任务执行耗时。
- **应用场景**：性能瓶颈定位、用户体验优化、SLO 阈值设定。

### **4. Error（错误率）**

统计服务运行中出现的错误或异常情况，包括系统错误（如 5xx 状态码）和业务错误（如库存不足、验证码失败）。错误率需结合业务逻辑定义，例如将 4xx 状态码纳入监控范围。

- **示例**：接口错误率、任务失败率、数据库死锁次数。
- **应用场景**：故障根因分析、错误预算消耗计算、业务逻辑优化。

### **5. Ticket（人工介入）**

衡量需要人工干预的操作或故障次数，例如手动恢复任务、人工处理异常工单等。Ticket 指标反映系统自动化能力，其 SLO 通常设定为 “每月人工介入次数≤X 次”57。

- **示例**：数据任务手动恢复次数、异常工单处理量、人工扩容操作频率。
- **应用场景**：自动化水平评估、运维效率优化、SLO 目标校准。

## **VALET 原则的应用价值**

1. **精准定义 SLO**通过 VALET 的五个维度，团队可以系统性地选择 SLI（服务等级指标），并为每个指标设定 SLO 目标。例如，某电商平台可能设定：
    - **Volume**：日常 QPS≥10 万，大促 QPS≥50 万；
    - **Availability**：请求成功率≥99.95%；
    - **Latency**：90% 请求响应时间≤100ms；
    - **Error**：业务错误率≤0.1%；
    - **Ticket**：每月人工介入≤5 次。
2. **驱动故障预防与响应**VALET 原则帮助团队将监控焦点从 “事后告警” 转向 “事前预防”。例如，通过监控 Volume 指标预测流量峰值，提前扩容；通过 Ticket 指标推动自动化脚本开发，减少人工干预。
3. **统一团队协作语言**在 SRE 实践中，VALET 原则为开发、运维、产品团队提供了共同的评估标准。例如，当错误预算消耗过快时，团队可基于 VALET 指标快速定位问题（如 Latency 升高导致 Error 率上升），并优先处理高优先级任务。

## **实施 VALET 原则的注意事项**

1. **指标分层与关联**需根据系统层级（如终端层、应用层、PaaS 层、IaaS 层）设计指标，并建立跨层关联。例如，终端层的用户体验指标（如 APP 崩溃率）需与应用层的 API 时延、错误率关联分析。
2. **动态调整与迭代**VALET 指标需根据业务变化和系统演进持续优化。例如，新功能上线后可能引入新的 Error 场景，需调整错误率定义；大促期间可临时放宽 Volume 指标的 SLO 阈值。
3. **工具与流程支撑**需借助监控平台（如 Prometheus、Datadog）和 AIOps 工具实现指标采集、分析和告警。同时，需建立 SLO 复盘机制，定期评估 VALET 指标的有效性。

# 监控指标的常见收集方案

1. **基于采集代理的方案**
    - **Prometheus**：通过部署 Prometheus 服务器和各类 Exporter（如 Node Exporter、cAdvisor 等），对系统和应用进行指标采集、存储与查询。Prometheus 支持强大的查询语言（PromQL），便于进行实时监控与报警设置。
    - **Telegraf + InfluxDB + Grafana（TIG Stack）**：Telegraf 作为数据采集代理，可以从各类系统、应用中采集指标数据，然后存储到 InfluxDB 中，最后通过 Grafana 展示数据和设置报警。
2. **云服务平台自带的监控工具**
    - **AWS CloudWatch**、**Azure Monitor**、**Google Cloud Monitoring**：各大云平台均提供内置的监控解决方案，能对云资源、应用及自定义指标进行采集、存储和可视化，方便云上服务的健康管理。
3. **应用内嵌监控方案**
    - **OpenTelemetry**：作为业界标准的监控和追踪工具，通过在代码中嵌入 OpenTelemetry SDK，可以实现对应用运行时行为的全面监控，并导出日志、指标和追踪数据。
    - **自定义埋点与统计**：在业务代码中加入特定的埋点，通过专用库采集业务层面的指标，并上报到监控平台。
4. **日志解析提取指标**
    - 利用 ELK（Elasticsearch、Logstash、Kibana）或类似的日志管理平台，通过日志采集与解析，从日志中提取有意义的数值指标，用于构建监控报表和报警规则。

综上所述，监控指标不仅能提供系统运行状态的量化反馈，还能为整个可观测性体系提供数据支持，是实现自动报警、故障定位、性能调优等关键功能的基础。通过多种方案（如 Prometheus、云平台监控、OpenTelemetry 等），团队可以构建一个全面而高效的指标监控系统，从而实现对复杂分布式系统的实时掌控。