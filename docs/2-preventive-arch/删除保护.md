数据一旦被彻底删除，就再也无法找回了，风险很高，因此对于资源的删除操作，原则上需要有一定保护。

- 【必须】删除权限需要收敛，加上认证（谁删除的）和资源控制（谁可以删）。
- 【推荐】软删除 or **回收站功能**——数据不直接删除，只是置上“删除”的标志位，等待一段时间后再真实删除数据。这样一旦发现误删，可能可以来得及挽回。
- 【推荐】删除需要 Double Check（界面交互），并给出相关的风险提示。
- 【推荐】资源默认给出删除保护：默认情况下，数据无法被删除，必须显式解除保护后，数据才可以删除。


# 软删除

在传统的数据库操作中，删除操作是指将数据从数据库中永久删除，不可恢复。但是，有时候我们希望保留被删除数据的一些信息，或者有可能需要在之后的时间点恢复这些数据。软删除就是通过标记数据的删除状态而不是物理删除来实现这一目的。

逻辑删除是最简单和常见的方式。逻辑删除通过在表中添加一个布尔类型的删除状态列来实现。当数据被软删除时，这个列的值会被标记为true。逻辑删除可以很容易地在查询中过滤掉被删除的数据，因为我们只需要在查询条件中添加`is_deleted=false`的条件。

以下是一个示例表的设计，使用逻辑删除方式实现软删除：

```jsx
CREATE TABLE users (
  id INT PRIMARY KEY,
  name VARCHAR(100),
  is_deleted BOOLEAN DEFAULT false
);
```

另外，推荐在删除的时候，可以使用一个`deleted_at`字段来记录删除时间，这样我们可以知道数据是何时被删除的。这对于一些需要记录历史数据变动的应用场景非常有用。

对于被软删除的数据，我们可能最终还是要删除这些数据，我们可以为这些数据，设置一个过期时间，比如六个月。

为啥推荐是六个月呢？2017年6月1日起施行的《中华人民共和国网络安全法》中规定：采取监测、记录网络运行状态、网络安全事件的技术措施，并按照规定留存相关的网络日志**不少于六个月**。

因此，我们可以在服务的后台实现一个周期性的检查，一旦：

1. 数据量达到一定程度，或
2. 有过期的数据

则发起清理：

1. 清理所有过期的数据；
2. 如果清理后数据存储的压力还是过大，继续清理无用数据（可能还未过期）。


[本地文件防误删](https://www.notion.so/3a9be485baa94667a4f8b88a69e0bbb9?pvs=21)